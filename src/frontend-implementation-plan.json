{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Stabilize chat scrolling with fixed-height overflow container and bottom-aware native auto-scroll",
  "requirements": [
    {
      "id": "REQ-1",
      "summary": "Replace the chat message scroller with a fixed-height, always-scrollable overflow container (no ScrollArea) while keeping the input pinned at the bottom.",
      "acceptanceCriteria": [
        "The chat messages render inside a container with a stable, fixed height relative to the page layout (no growing with content).",
        "The message list container uses vertical scrolling (`overflow-y: auto`) and users can always scroll through history.",
        "The chat input area remains visible and positioned at the bottom of the chat card while the message list scrolls independently.",
        "Works on both mobile and desktop viewports."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/Chat/ChatPage.tsx",
          "operation": "modify",
          "description": "Remove usage of the current ScrollArea for the message list and render messages inside a flex child container that has stable height within the page layout (e.g., Card with `flex flex-col`, message container with `flex-1 min-h-0 overflow-y-auto`, input area below). Ensure the message container remains scrollable on both mobile and desktop without affecting page-level scroll."
        }
      ]
    },
    {
      "id": "REQ-2",
      "summary": "Implement bottom-aware auto-scroll: only scroll when the user is already at/near bottom; disable while user scrolls up and re-enable when they return.",
      "acceptanceCriteria": [
        "When the user is at the bottom and a new message is added, the view scrolls to the latest message.",
        "When the user scrolls up (not at bottom) and new messages are added, the scroll position does not jump and the user remains at the same reading position.",
        "When the user scrolls back to the bottom, auto-scroll re-enables for subsequent new messages."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/Chat/ChatPage.tsx",
          "operation": "modify",
          "description": "Add bottom-awareness tracking on the message scroll container (use a container ref and an onScroll handler). Maintain a ref/state flag like `isAtBottom` computed via `scrollTop + clientHeight >= scrollHeight - threshold`. On message append, only auto-scroll when `isAtBottom` is true; if the user scrolls up, keep it false until they scroll back near bottom."
        }
      ]
    },
    {
      "id": "REQ-3",
      "summary": "Preserve scroll position across renders by removing unconditional scrolling and preventing scrollTop resets/jumps when messages change.",
      "acceptanceCriteria": [
        "Sending a message does not cause the chat to jump upward.",
        "Users can scroll up and continue reading older messages even while new messages arrive.",
        "Long conversations remain smooth and readable; the scroller does not lock or become unusable."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/Chat/ChatPage.tsx",
          "operation": "modify",
          "description": "Remove/replace unconditional `scrollIntoView` behavior tied to every `messages` change. Drive scrolling via the scroll container (not a sentinel div) and only when bottom-aware conditions allow it. Ensure the scroll container is stable (`min-h-0` within the flex column) so new messages do not trigger layout growth that causes page reflow or scroll locking."
        }
      ]
    },
    {
      "id": "REQ-4",
      "summary": "Use native smooth scrolling on the chat message container when auto-scroll is permitted.",
      "acceptanceCriteria": [
        "When auto-scroll occurs, it uses smooth native scrolling behavior.",
        "Smooth scrolling is applied only to the chat message container (not the entire page)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/Chat/ChatPage.tsx",
          "operation": "modify",
          "description": "When `isAtBottom` is true and a new message is appended, perform native container scrolling using the container ref (e.g., `element.scrollTo({ top: element.scrollHeight, behavior: 'smooth' })`). Ensure this targets only the message scroll container and does not trigger page-level scrolling."
        }
      ]
    }
  ]
}