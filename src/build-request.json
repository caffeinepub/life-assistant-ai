{
  "kind": "build_request",
  "title": "Fix chat scroll jump/lock by replacing ScrollArea with fixed-height overflow container and bottom-aware auto-scroll",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Replace the current chat message scroller implementation in `frontend/src/pages/Chat/ChatPage.tsx` so the message list is rendered inside a fixed-height container that uses `overflow-y: auto` and remains scrollable at all times (mobile + desktop). Do not rely on the current `ScrollArea` component for the message list if it prevents correct scroll behavior.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "The chat message list must be wrapped in a fixed-height container\n\nThe container must use overflow-y: auto (not hidden, not default)\n\nIf the current chat component cannot support this behavior, replace it with a custom chat container that does."
        ]
      },
      "acceptanceCriteria": [
        "The chat messages render inside a container with a stable, fixed height relative to the page layout (no growing with content).",
        "The message list container uses vertical scrolling (`overflow-y: auto`) and users can always scroll through history.",
        "The chat input area remains visible and positioned at the bottom of the chat card while the message list scrolls independently.",
        "Works on both mobile and desktop viewports."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Implement bottom-aware auto-scroll logic in `frontend/src/pages/Chat/ChatPage.tsx`: auto-scroll to the bottom ONLY when the user is already at (or near) the bottom at the moment a new message is appended. If the user scrolls up, disable auto-scroll until the user scrolls back to the bottom.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "Auto-scroll must trigger ONLY when the user is already at the bottom\n\nIf the user scrolls up, auto-scroll must be disabled"
        ]
      },
      "acceptanceCriteria": [
        "When the user is at the bottom and a new message is added, the view scrolls to the latest message.",
        "When the user scrolls up (not at bottom) and new messages are added, the scroll position does not jump and the user remains at the same reading position.",
        "When the user scrolls back to the bottom, auto-scroll re-enables for subsequent new messages."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Preserve scroll position across renders and prevent scrollTop resets on new messages in `frontend/src/pages/Chat/ChatPage.tsx`. Remove/replace any logic that unconditionally forces scrolling on every `messages` change (e.g., unconditional `scrollIntoView`), and ensure adding messages does not cause page reflow or lock scrolling.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "When a new message arrives, do not reset scrollTop\n\nPreserve scroll position across renders\n\nApply the fix at logic + layout level, not visual styling only\n\nDo not reflow the entire page on new messages"
        ]
      },
      "acceptanceCriteria": [
        "Sending a message does not cause the chat to jump upward.",
        "Users can scroll up and continue reading older messages even while new messages arrive.",
        "Long conversations remain smooth and readable; the scroller does not lock or become unusable."
      ]
    },
    {
      "id": "REQ-4",
      "text": "Enable smooth scrolling using native browser behavior when auto-scroll is allowed (user is at bottom), using native scroll APIs on the scroll container (not page-level scrolling).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "Enable smooth scrolling using native browser behavior"
        ]
      },
      "acceptanceCriteria": [
        "When auto-scroll occurs, it uses smooth native scrolling behavior.",
        "Smooth scrolling is applied only to the chat message container (not the entire page)."
      ]
    }
  ],
  "constraints": [
    "Frontend must apply the fix at logic + layout level (not styling-only).",
    "Do not edit files under `frontend/src/components/ui` (compose/replace usage instead).",
    "Do not implement real-time/WebSocket behavior; fix applies to current message append flow only."
  ],
  "nonGoals": [
    "Changing the visual design/theme of the chat bubbles or overall app styling beyond what is necessary to achieve stable scrolling.",
    "Adding new chat features (typing indicators beyond existing, message reactions, persistence, pagination, etc.).",
    "Backend changes (Motoko) are not required for this scroll fix."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}